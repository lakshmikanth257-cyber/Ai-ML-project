# AsyaðŸŽ­ Framework Deployment

This directory contains Helm charts for deploying the AsyaðŸŽ­ framework components.

## What is the AsyaðŸŽ­ Operator?

The AsyaðŸŽ­ operator is a **single Kubernetes operator** that watches AsyncActor CRDs and manages their lifecycle. It does NOT deploy actors themselves - it only deploys the operator pod that manages actors.

When installed, it:
- Runs as a single Deployment in your cluster
- Watches for Actor custom resources
- Automatically injects sidecar containers into actor workloads
- Manages Deployments or StatefulSets based on Actor specs
- Configures KEDA autoscaling
- Sets up RBAC and secrets

## Contents

### Operator Chart (`helm-charts/asya-operator/`)

Helm chart that deploys only the operator pod:

```bash
# Install the operator
helm install asya-operator helm-charts/asya-operator --create-namespace -n asya-system

# Or upgrade
helm upgrade --install asya-operator helm-charts/asya-operator -n asya-system
```

### Gateway Chart (`helm-charts/asya-gateway/`)

Helm chart for deploying the AsyaðŸŽ­ MCP gateway with PostgreSQL backend:

```bash
# Install with bundled PostgreSQL (recommended)
helm dependency update helm-charts/asya-gateway
helm install asya-gateway helm-charts/asya-gateway --create-namespace -n asya

# Or upgrade
helm upgrade --install asya-gateway helm-charts/asya-gateway -n asya
```

See [helm-charts/asya-gateway/README.md](helm-charts/asya-gateway/README.md) for detailed configuration options.

## Quick Start

**Automated E2E Testing Deployment**

For local testing with full stack:
```bash
cd ../testing/e2e
make up
```

See [docs/install/local-kind.md](../docs/install/local-kind.md) for detailed local deployment instructions.

**Minimal Framework Installation**

Install just the operator and CRDs:

```bash
# 1. Install CRDs
kubectl apply -f ../src/asya-operator/config/crd/

# 2. Install operator
helm install asya-operator helm-charts/asya-operator --create-namespace -n asya-system

# 3. Deploy actors
kubectl apply -f ../examples/asyas/simple-actor.yaml
```

The operator will watch for AsyncActor resources and create the necessary Deployments, sidecars, and KEDA configurations.

## What Gets Deployed?

**This chart deploys:**
- 1 operator Deployment (runs the `asya-operator` pod)
- ServiceAccount and RBAC for the operator
- Service for metrics/health endpoints

**This chart does NOT deploy:**
- CRDs (install separately from `src/asya-operator/config/crd/`)
- Actors (create AsyncActor resources after operator is running)
- KEDA (install separately if using autoscaling)

## CRD Management

The AsyncActor CRD is maintained in `../src/asya-operator/config/crd/` and generated by Kubebuilder from Go API types.

To regenerate CRDs after modifying the API:
```bash
cd ../operator
make manifests
```

## Upgrading

```bash
# Update CRDs first
kubectl apply -f ../src/asya-operator/config/crd/

# Then upgrade operator
helm upgrade asya-operator helm-charts/asya-operator -n asya-system
```

## Uninstalling

```bash
# Delete operator
helm uninstall asya-operator -n asya-system

# Delete CRDs (WARNING: this will delete all AsyncActor resources!)
kubectl delete -f ../src/asya-operator/config/crd/
```

## Examples

See `../examples/asyas/` for AsyncActor CRD examples.

For deployment guides, see:
- [Local Kind Installation](../docs/install/local-kind.md)
- [AWS EKS Installation](../docs/install/aws-eks.md)
- [Helm Charts Documentation](../docs/install/helm-charts.md)
