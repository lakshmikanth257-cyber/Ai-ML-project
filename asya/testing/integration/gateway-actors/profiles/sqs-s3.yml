# Profile: SQS + S3
#
# This configuration uses:
# - LocalStack (SQS emulation) for message transport
# - LocalStack (S3 emulation) for object storage
#
# Usage: docker compose -f profiles/sqs-s3.yml up

include:
# Base infrastructure
- path: ../../../shared/compose/sqs.yml
- path: ../../../shared/compose/s3.yml
- path: ../../../shared/compose/postgres.yml
# Asya components:
- path: ../../../shared/compose/asya/testing-actors.yml
  env_file: .env.sqs-s3
- path: ../../../shared/compose/asya/crew-actors.yml
  env_file: .env.sqs-s3

services:
  gateway:
    extends:
      file: ../../../shared/compose/asya/gateway.yml
      service: gateway
    env_file: .env.sqs-s3
    depends_on:
      sqs:
        condition: service_healthy
      queue-setup:
        condition: service_completed_successfully
      postgres-migrate:
        condition: service_completed_successfully


  tester:
    extends:
      file: ../compose/tester.yml
      service: tester
    env_file: .env.sqs-s3
    depends_on:
      sqs:
        condition: service_healthy
      s3:
        condition: service_healthy
      queue-setup:
        condition: service_completed_successfully
      postgres-migrate:
        condition: service_completed_successfully
      storage-setup:
        condition: service_completed_successfully
      gateway:
        condition: service_healthy
      test-actors-waiter:
        condition: service_completed_successfully
      crew-actors-waiter:
        condition: service_completed_successfully

volumes:
  asya-echo-sockets:
  asya-doubler-sockets:
  asya-incrementer-sockets:
  asya-error-sockets:
  asya-timeout-sockets:
  asya-fanout-sockets:
  asya-empty-sockets:
  asya-unicode-sockets:
  asya-large-payload-sockets:
  asya-nested-sockets:
  asya-null-sockets:
  asya-slow-boundary-sockets:
  asya-cycle-sockets:
  asya-param-flow-1-sockets:
  asya-param-flow-2-sockets:
  asya-happy-end-sockets:
  asya-error-end-sockets:
